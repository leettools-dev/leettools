# Generated using the docker/Dockerfile.dev.template file using
# 
# python docker/gen_dockerfile.py
# 
# DO NOT EDIT THIS FILE MANUALLY

# Use an official Python runtime as a parent image
FROM python:3.11-slim

RUN apt-get update && apt-get upgrade -y \
    && apt-get install -y gcc python3-dev \
    && pip install --upgrade pip

# we separate these requirements to speed up the build process
# this part should not change much normally
# removed the -no-cache-dir to speed up local build

RUN pip install --no-cache-dir click==8.1.7

RUN pip install --no-cache-dir Jinja2==3.1.3

RUN pip install --no-cache-dir markdownify==0.13.1

RUN pip install --no-cache-dir aiofiles==23.2.1

RUN pip install --no-cache-dir pyyaml==6.0.2

RUN pip install --no-cache-dir pydantic==2.10.3

RUN pip install --no-cache-dir python-dotenv==1.0.1

RUN pip install --no-cache-dir Requests==2.32.3

RUN pip install --no-cache-dir httpx==0.27.2

RUN pip install --no-cache-dir fastapi==0.109.2

RUN pip install --no-cache-dir uvicorn==0.27.1

RUN pip install --no-cache-dir rich==13.9.4

RUN pip install --no-cache-dir nltk==3.8.1

RUN pip install --no-cache-dir psutil==5.9.8

RUN pip install --no-cache-dir tldextract==5.1.3

RUN pip install --no-cache-dir urllib3==2.2.3

RUN pip install --no-cache-dir Babel==2.16.0


# the version of the following lbraries may change more often

RUN pip install --no-cache-dir beautifulsoup4==4.12.3

RUN pip install --no-cache-dir openai==1.59.7

RUN pip install --no-cache-dir scipy==1.14.1

RUN pip install --no-cache-dir sentence_transformers==2.5.1

RUN pip install --no-cache-dir tiktoken==0.8.0

RUN pip install --no-cache-dir duckdb==1.1.3

RUN pip install --no-cache-dir docling==2.26.0

RUN pip install --no-cache-dir docling_core==2.23.0

RUN pip install --no-cache-dir chonkie==0.5.1

RUN pip install --no-cache-dir langchain-community==0.3.15

RUN pip install --no-cache-dir langid==1.1.6

RUN pip install --no-cache-dir nest-asyncio==1.6.0

RUN pip install --no-cache-dir firecrawl-py==1.12.0

RUN pip install --no-cache-dir lxml==5.3.0


# it seems that the version of apache2-utils is not stable
# fixed version installation breaks from time to time
# e.g., we were using 2.4.59-1, but somehow the repo changed to 2.4.59-1~deb12u1
# Setting up apache2-utils (2.4.59-1~deb12u1) ...
RUN apt-get install -y apache2-utils && rm -rf /var/lib/apt/lists/*

# Set working directory in the container
WORKDIR /app

# Copy all files from your local filesystem into the container
COPY . .

# Install dependencies from requirements.txt
# most should have been installed above
RUN pip install -e . \
    && pybabel compile -d src/leettools/common/i18n/locales \
    && chmod +x scripts/run.sh

# Expose port 8000
EXPOSE ${EDS_API_SERVICE_PORT}

ENV LOG_OUTPUT="console"
ENV GIT_SHA=$GIT_SHA

CMD ["./scripts/run.sh"]